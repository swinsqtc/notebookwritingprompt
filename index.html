<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Writing Prompt</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url("https://static.vecteezy.com/system/resources/previews/014/456/699/non_2x/line-notebook-paper-on-white-background-free-vector.jpg") center/cover no-repeat;
      font-family: "Patrick Hand", "Comic Sans MS", cursive;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 75vh;
      background-attachment: fixed;
    }

    .widget {
      position: relative;
      background: rgba(0, 0, 0, 0);
      border-radius: 16px;
      padding: 40px 60px;
      max-width: 875px;
      width: 90%;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0);
      line-height: 2.1;
      text-align: center;
      backdrop-filter: blur(3px);
    }

    h1 {
      font-size: 4.5em;
      color: #0b1b2b;
      text-align: center;
      margin-bottom: 1em;
      font-weight: bold;
    }

    #todayDate {
      position: absolute;
      top: 16px;
      right: 20px;
      font-size: 3em;
      color: #333;
      font-weight: bold;
    }

    #promptText {
      font-size: 3.5em;
      color: #1a1a1a;
      white-space: pre-wrap;
      padding-left: 30px;
      text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
    }

    #teacherToggle {
      display: block;
      margin: 24px auto 0;
      background: #f9d342;
      color: #333;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    #teacherPanel {
      display: none;
      margin-top: 16px;
      background: rgba(255, 255, 240, 0.85);
      padding: 20px;
      border-radius: 10px;
      box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
    }

    #teacherPanel input,
    #teacherPanel textarea {
      width: 95%;
      margin: 10px 0;
      padding: 10px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #teacherPanel button {
      background: #0b5cff;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    #teacherMsg {
      color: #333;
      margin-top: 10px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
</head>
<body>
  <div class="widget">
    <h1>‚úèÔ∏è Daily Writing Prompt</h1>
    <div id="todayDate"></div>
    <div id="promptText">Loading prompt‚Ä¶</div>

    <button id="teacherToggle">‚öôÔ∏è</button>
    <div id="teacherPanel">
      <input type="password" id="teacherPassword" placeholder="Enter Password" />
      <button id="teacherLogin">Log In</button>

      <div id="teacherControls" style="display:none;">
        <textarea id="manualPrompt" placeholder="Enter custom prompt for today‚Ä¶"></textarea>
        <button id="applyPrompt">Apply Prompt</button>
        <p id="teacherMsg"></p>
      </div>
    </div>
  </div>

  <script>
    const noSchoolDates = [
      "2025-09-23","2025-09-24","2025-10-02","2025-10-13","2025-10-20","2025-11-04",
      "2025-11-11","2025-11-27","2025-11-28","2026-01-19","2026-03-20","2026-05-25",
      "2026-05-27","2026-06-04","2026-06-05","2026-06-19"
    ];
    function addRange(start, end) {
      const s = new Date(start), e = new Date(end);
      for (let d = new Date(s); d <= e; d.setDate(d.getDate() + 1)) {
        noSchoolDates.push(d.toISOString().split("T")[0]);
      }
    }
    addRange("2025-12-24","2026-01-02");
    addRange("2026-02-16","2026-02-20");
    addRange("2026-04-02","2026-04-10");

    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyn4gIZw-c9F5fNQdPAgF9Diwspr6Ly3gndfpkyGZw5mGFct5lN8Vuv4ltKhfmZUA3CkY2vh24gNXB/pub?output=csv";
    const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(sheetUrl);

    function isNoSchool(date) {
      const ymd = date.toISOString().split("T")[0];
      return noSchoolDates.includes(ymd);
    }

    function setTodayDate() {
      const today = new Date();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const yy = String(today.getFullYear()).slice(-2);
      document.getElementById("todayDate").textContent = `${mm}/${dd}/${yy}`;
    }

    async function loadPrompt() {
      setTodayDate();

      try {
        const response = await fetch(proxy);
        if (!response.ok) throw new Error("Network response error");
        const text = await response.text();
        const prompts = text.split("\n").map(p => p.trim()).filter(p => p);

        const today = new Date();
        today.setHours(0,0,0,0);

        if (isNoSchool(today)) {
          document.getElementById("promptText").textContent = "No School Today!";
          return;
        }

        const start = new Date("2025-09-04");
        let count = 0;
        for (let d = new Date(start); d <= today; d.setDate(d.getDate() + 1)) {
          const weekend = d.getDay() === 0 || d.getDay() === 6;
          if (!weekend && !isNoSchool(d)) count++;
        }

        const idx = (count - 1) % prompts.length;
        const override = localStorage.getItem("teacherOverridePrompt");
        document.getElementById("promptText").textContent = override || prompts[idx] || "No prompt found.";
      } catch (err) {
        console.error(err);
        document.getElementById("promptText").textContent = "Error loading prompt. Please check your Google Sheet link.";
      }
    }

    // Teacher Login
    document.getElementById("teacherToggle").addEventListener("click", () => {
      const panel = document.getElementById("teacherPanel");
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    });

    document.getElementById("teacherLogin").addEventListener("click", () => {
      const pw = document.getElementById("teacherPassword").value;
      if (pw === "Mone270") {
        document.getElementById("teacherControls").style.display = "block";
        document.getElementById("teacherPassword").style.display = "none";
        document.getElementById("teacherLogin").style.display = "none";
      } else {
        alert("Incorrect password");
      }
    });

    document.getElementById("applyPrompt").addEventListener("click", () => {
      const newPrompt = document.getElementById("manualPrompt").value.trim();
      const msg = document.getElementById("teacherMsg");
      if (newPrompt) {
        localStorage.setItem("teacherOverridePrompt", newPrompt);
        document.getElementById("promptText").textContent = newPrompt;
        msg.textContent = "‚úÖ Custom prompt applied for today.";
      } else {
        localStorage.removeItem("teacherOverridePrompt");
        msg.textContent = "üßπ Custom prompt cleared.";
        loadPrompt();
      }
    });

    loadPrompt();
  </script>
</body>
</html>
